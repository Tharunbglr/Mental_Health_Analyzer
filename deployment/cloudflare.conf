# Cloudflare configuration for mental-health-analyzer

# DNS Configuration
Type   Name                     Content              Proxy Status   TTL
A      yourmentalhealth.com    <server-ip>          Proxied        Auto
CNAME   www                     yourmentalhealth.com Proxied        Auto

# Page Rules
URL Pattern                     Setting              Value
*yourmentalhealth.com/static/* Cache Level          Cache Everything
*yourmentalhealth.com/*        SSL                  Full (Strict)
*yourmentalhealth.com/api/*    Security Level       High

# Security Settings
Setting                         Value                Notes
SSL                            Full (Strict)        Require client cert
WAF                            High                 Block suspicious
Bot Fight Mode                 On                   Protect forms
Browser Integrity Check        On                   Verify clients
Challenge Passage              30 Minutes           CAPTCHA timeout
Email Obfuscation             On                   Protect emails
Hotlink Protection            On                   Protect assets
IP Geolocation                On                   Location header
Security Level                Medium               Base protection
TLS 1.3                       On                   Modern crypto
Always Use HTTPS              On                   Force HTTPS
Automatic HTTPS Rewrites      On                   Fix mixed content
Opportunistic Encryption      On                   Support 0-RTT
TLS Client Auth              Off                   No client certs
Security Headers             Configure:
  X-XSS-Protection           1; mode=block
  X-Content-Type-Options    nosniff
  X-Frame-Options           DENY
  Referrer-Policy          strict-origin-when-cross-origin

# Caching Configuration
Setting                        Value
Browser Cache TTL             4 hours
Cache Level                   Standard
Always Online                 On
Development Mode             Off
Query String Sort            On
Polish                       Lossless
WebP                         On

# Rate Limiting Rules
URI Pattern                   Threshold       Period    Action
/analyze                     100             1 day     Challenge
/static/*                    1000            1 minute  Challenge
*                           300              1 minute  Challenge

# Transform Rules
# Add security headers
Expression: http.request.uri.path matches "/.*"
Add response header: Strict-Transport-Security "max-age=31536000; includeSubDomains"
Add response header: Content-Security-Policy "default-src 'self'..."

# Workers
# Rate limiting worker
addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

async function handleRequest(request) {
  const ip = request.headers.get('CF-Connecting-IP')
  const key = `rate_limit:${ip}`
  
  // Check rate limit
  const rateLimitResponse = await checkRateLimit(key)
  if (rateLimitResponse) return rateLimitResponse
  
  // Forward request
  return fetch(request)
}